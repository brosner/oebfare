/*
Copyright (c) 2008, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.net/yui/license.txt
version: 3.0.0pr1
*/
YUI.add("anim-base",function(B){var C="running",N="startTime",L="elapsedTime",J="start",I="tween",M="end",D="node",K="paused",Q="reverse",H="iterationCount",A=Number;var F={},P={},E;var O=function(R,T,S){if(typeof T=="string"){R._conf.add(T,{value:S});}else{B.each(T,function(U,V){O(R,V,U);});}};B.Anim=function(){B.Anim.superclass.constructor.apply(this,arguments);P[B.stamp(this)]=this;};B.Anim.NAME="anim";B.Anim.RE_DEFAULT_UNIT=/^width|height|top|right|bottom|left|margin.*|padding.*|border.*$/i;B.Anim.DEFAULT_UNIT="px";B.Anim.behaviors={left:{get:function(S,R){return S._getOffset(R);}}};B.Anim.behaviors.top=B.Anim.behaviors.left;B.Anim.DEFAULT_SETTER=function(V,S,Y,X,R,W,T,U){U=U||"";V._node.setStyle(S,T(R,A(Y),A(X)-A(Y),W)+U);};B.Anim.DEFAULT_GETTER=function(R,S){return R._node.getComputedStyle(S);};B.Anim.ATTRS={node:{set:function(R){R=B.Node.get(R);this._node=R;if(!R){B.fail("Y.Anim: invalid node: "+R);}return R;}},duration:{value:1},easing:{value:function(S,R,U,T){return U*S/T+R;}},from:{},to:{},startTime:{value:0,readOnly:true},elapsedTime:{value:0,readOnly:true},running:{get:function(){return !!F[B.stamp(this)];},value:false,readOnly:true},iterations:{value:1},iterationCount:{value:0,readOnly:true},direction:{value:"normal"},paused:{readOnly:true,value:false},reverse:{value:false}};B.Anim.run=function(){for(var R in P){if(P[R].run){P[R].run();}}};B.Anim.pause=function(){for(var R in F){if(F[R].pause){F[R].pause();}}B.Anim._stopTimer();};B.Anim.stop=function(){for(var R in F){if(F[R].stop){F[R].stop();}}B.Anim._stopTimer();};B.Anim._startTimer=function(){if(!E){E=setInterval(B.Anim._runFrame,1);}};B.Anim._stopTimer=function(){clearInterval(E);E=0;};B.Anim._runFrame=function(){var R=true;for(var S in F){if(F[S]._runFrame){R=false;F[S]._runFrame();}}if(R){B.Anim._stopTimer();}};B.Anim.RE_UNITS=/^(-?\d*\.?\d*){1}(em|ex|px|in|cm|mm|pt|pc|%)*$/;var G={run:function(){if(!this.get(C)){this._start();}else{if(this.get(K)){this._resume();}}return this;},pause:function(){if(this.get(C)){this._pause();}return this;},stop:function(R){if(this.get(C)||this.get(K)){this._end(R);}return this;},_added:false,_start:function(){O(this,N,new Date()-this.get(L));this._actualFrames=0;if(!this.get(K)){this._initAttr();}F[B.stamp(this)]=this;B.Anim._startTimer();this.fire(J);},_pause:function(){O(this,N,null);O(this,K,true);delete F[B.stamp(this)];this.fire("pause");},_resume:function(){O(this,K,false);F[B.stamp(this)]=this;this.fire("resume");},_end:function(R){O(this,N,null);O(this,L,0);O(this,K,false);delete F[B.stamp(this)];this.fire(M,{elapsed:this.get(L)});},_runFrame:function(){var Y=this._runtimeAttr,T=B.Anim.behaviors,Z=Y.easing,a=Y.duration,b=new Date()-this.get(N),X=this.get(Q),V=(b>=a),R=a,S,U;if(X){b=a-b;V=(b<=0);R=0;}for(var W in Y){if(Y[W].to){S=Y[W];U=(W in T&&"set" in T[W])?T[W].set:B.Anim.DEFAULT_SETTER;if(!V){U(this,W,S.from,S.to,b,a,Z,S.unit);}else{U(this,W,S.from,S.to,R,a,Z,S.unit);}}}this._actualFrames+=1;O(this,L,b);this.fire(I);if(V){this._lastFrame();}},_lastFrame:function(){var R=this.get("iterations"),S=this.get(H);S+=1;if(R==="infinite"||S<R){if(this.get("direction")==="alternate"){this.set(Q,!this.get(Q));}this.fire("iteration");}else{S=0;this._end();}O(this,N,new Date());O(this,H,S);},_initAttr:function(){var Y=this.get("from")||{},Z=this.get("to")||{},R=this.get("duration")*1000,U=this.get(D),X=this.get("easing")||{},W={},S=B.Anim.behaviors,a,T,V;B.each(Z,function(g,d){if(typeof g==="function"){g=g.call(this,U);}T=Y[d];if(T===undefined){T=(d in S&&"get" in S[d])?S[d].get(this,d):B.Anim.DEFAULT_GETTER(this,d);}else{if(typeof T==="function"){T=T.call(this,U);}}var c=B.Anim.RE_UNITS.exec(T);var e=B.Anim.RE_UNITS.exec(g);T=c?c[1]:T;var b=e?e[1]:g,f=e?e[2]:c?c[2]:"";if(!f&&B.Anim.RE_DEFAULT_UNIT.test(d)){f=B.Anim.DEFAULT_UNIT;}if(!T||!b){B.fail('invalid "from" or "to" for "'+d+'"',"Anim");return ;}W[d]={from:T,to:b,unit:f};W.duration=R;W.easing=X;},this);this._runtimeAttr=W;},_getOffset:function(S){var U=this._node,V=U.getComputedStyle(S),T=(S==="left")?"getX":"getY",W=(S==="left")?"setX":"setY";if(V==="auto"){var R=U.getStyle("position");if(R==="absolute"||R==="fixed"){V=U[T]();U[W](V);}else{V=0;}}return V;}};B.extend(B.Anim,B.Base,G);},"3.0.0pr1",{requires:["base","node"]});